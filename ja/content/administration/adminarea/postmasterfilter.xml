<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<section id="adminarea-postmasterfilter">
<title>Filtering Incoming Email Messages</title>

<para>
OTRS has the capability to filter incoming email messages. For example, it
is possible to put certain emails automatically into specified queues, or to
set a specific state or ticket type for some mails. The filters apply to all
incoming mails. You can manage your filters via the link "PostMaster Filter"
on the Admin page (see figure below).
</para>

<para>
<figure>
    <title>PostMaster filter management</title>
<screenshot>
<graphic scale="40"
fileref="screenshots/administration/adminarea/admin-postmasterfilter.png"></graphic></screenshot></figure>
</para>

<para>
A filter consists of one or more criteria that must be met in order for the
defined actions to be executed on the email. Filter criteria may be defined
for the headers or the body of an email, e.g. search for specific header
entries, such as a sender address, or on strings in the body. Even regular
expressions can be used for extended pattern matching. If your filter
matches, you can set fields using the X-OTRS headers in the GUI. These
values will be applied when creating the ticket or follow-up message in
OTRS. The Table 4-5 lists the different X-OTRS headers and their meaning.
</para>

<note>
<para>
You also can use X-OTRS-FollowUp-* headers to set values for follow up
emails.
</para>
</note>

<table id="table-of-x-otrs-headers">
<title>異なるX-OTRSヘッダーの機能</title>
  <tgroup cols="3">
    <thead>
      <row>
        <entry>
          Name
        </entry>
        <entry>
          可能な値
        </entry>
        <entry>
          摘要
        </entry>
      </row>
    </thead>
    <tbody>
      <row>
        <entry>
          X-OTRS-優先度:
        </entry>
        <entry>
          1 極低い, 2 低い, 3 普通, 4 高い, 5 極高い
        </entry>
        <entry>
          チケットの優先度を設定します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-キュー:
        </entry>
        <entry>
          システム内でのキュー名
        </entry>
        <entry>
          チケットがソートされる場合、キューをセットします。もしX-OTRSヘッダーの中でセットされれば、特定のキューへチケットをソートしようとする他のすべてのフィルタ規則が無視されます。サブキューを使用する場合は、「Parent::Sub」としてそれを指定してください。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-ロック:
        </entry>
        <entry>
            ロック、アンロック
        </entry>
        <entry>
          チケットのロック状態を設定します
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-無視:
        </entry>
        <entry>
          「はい」 あるいは 「真」
        </entry>
        <entry>
          このX-OTRSヘッダーが「はい」にセットされれば、受信メッセージは完全に無視され、システムに配達されないでしょう。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-状態:
        </entry>
        <entry>
          新規、対応中、完了（成功）、完了（不成功）...
        </entry>
        <entry>
          チケットの次の状態を設定します
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-状態-保留時間:
        </entry>
        <entry>
         例えば 2010-11-20 00:00:00
        </entry>
        <entry>
            チケットの保留時間を設定します。（X-OTRS-Stateによって保留状態を送信もして下さい）電子メールの到着時刻に基づいて、「2010-11-20
00:00:00」のような絶対日付あるいは相対日付を指定することができます。フォーム「+ $Number
$Unit」を使用してください。ここで、「$Unit」は、's'の(秒)、「m」(分)、「h」(時間)あるいは「d」(日)です。1ユニットのみ指定することができます。有効な設定例:「+50s」(50秒でペンディング)、「+30m」(30分)、「+12d」(12日)。「+1d
12h」のようなセッティングができないことに注意してください。その代わりに「+36h」を指定できます。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-タイプ:
        </entry>
        <entry>
         デフォルト (あなたの実施したセットアップに依存します)
        </entry>
        <entry>
          チケットタイプの設定 (Ticket::Type が活性化されていれば)。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-サービス:
        </entry>
        <entry>
         （セットアップにもよりますが）
        </entry>
        <entry>
          チケットのサービスを設定します。(Ticket::Service
がアクティブならば)。サブキューを使用する場合は、&quot;Parent::Sub&quot; としてそれを指定してください。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-SLA:
        </entry>
        <entry>
         （セットアップにもよりますが）
        </entry>
        <entry>
          チケットのSLAを設定します。(Ticket::Service support がアクティブならば)。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-顧客ユーザ:
        </entry>
        <entry>
          CustomerUser（顧客ユーザ）
        </entry>
        <entry>
          チケット用顧客ユーザーを設定します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-顧客番号:
        </entry>
        <entry>
          CustomerNo（顧客番号）
        </entry>
        <entry>
          このチケットの顧客IDを設定します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-送信者タイプ：
        </entry>
        <entry>
          担当者、システム、顧客
        </entry>
        <entry>
          このチケット送信者のタイプを設定します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-記事タイプ:
        </entry>
        <entry>
          外部Eメール、内部Eメール、外部Eメール通知、内部Eメール通知、電話、ファックス、SMS,ウェブリクエスト、内部ノート、外部ノート、ノートレポート。
        </entry>
        <entry>
          受信チケットの記事タイプを設定します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-DynamicField-&lt;DynamicFieldName&gt;:
        </entry>
        <entry>
          動的フィールドの構成に依存します（テキスト：ノートブック、日付：2010-11-20 00:00:00, Integer: 1)
        </entry>
        <entry>
          摘要:動的フィールド&lt;DynamicFieldName&gt; でチケットの追加情報値を保存します。
        </entry>
      </row>
      <row>
        <entry>
          X-OTRS-ループ:
        </entry>
        <entry>
          真
        </entry>
        <entry>
          このX-OTRSヘッダーが設定されたら、メッセージ送信者へ自動返信は配信されません。（メール・ループ保護のため）
        </entry>
      </row>
    </tbody>
  </tgroup>
</table>

<para>
You should specify a name for every filter rule. Filter criteria can be
specified in the section "Filter Condition". Choose via the listboxes for
"Header 1", "Header 2" and so on for the parts of the messages where you
would like to search, and specify on the right side the values you wish to
filter on. In the section "Set Email Headers", you can choose the actions
that are triggered if the filter rules match. You can select for "Header 1",
"Header 2" and so on to select the X-OTRS-Header and set the associated
values (see figure below).  Filter rules are evaluated in alphabetical
order, and are all executed except if the "Stop after match" setting has
been set to "Yes" in one of the rule (in this case evaluation of the
remaining filters is cancelled).
</para>

<para>
<figure>
    <title>Add a PostMaster filter</title>
<screenshot>
<graphic scale="40"
fileref="screenshots/administration/adminarea/add-postmasterfilter.png"></graphic></screenshot></figure>
</para>

<example id="sort-mails-into-junk">
<title>特定のキューの中へのスパム・メールのソート</title>

<para>
A useful filter rule would be to let OTRS automatically move mails marked
for spam, by using a spam detection tool such as SpamAssassin, into the
"Junk" queue. SpamAssassin adds the "X-Spam-Flag" header to every checked
mail. When the mail is marked as spam, the Header is set to "Yes". So the
filter criteria would be "X-Spam-Flag: Yes". To create a filter rule with
this criteria you can insert the name as, for example, "spam-mails". In the
section for "Filter Condition", choose "X-Spam-Flag:" for "Header 1" from
the listbox. Insert "Yes" as value for this header. Now the filter criteria
is specified. To make sure that all spam mails are placed into the "Junk"
queue, choose in the section for "Set Email Headers", the "X-OTRS-Queue:"
entry for "Header 1". Specify "Junk" as value for this header. Finally add
the new filter rule to activate it for new messages in the system.
</para>
</example>

<para>
追加モジュール(<link
linkend="email-receiving-filter">受信メッセージのフィルタリング</link>をより明確にするために使用することができる)があります。より大きく、より複雑なシステムに対処する場合、これらのモジュールは有用かもしれません。
</para>

</section>
